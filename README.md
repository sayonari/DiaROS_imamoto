# DiaROS
**[English ver is HERE](README_en.md)**

## Author
è¥¿æ‘è‰¯å¤ª è±Šæ©‹æŠ€è¡“ç§‘å­¦å¤§å­¦  
nishimura.ryota.tz@tut.jp

## Developer
- è¥¿æ‘ è‰¯å¤ª (Ryota Nishimura)
- æ£® è²´å¤§ (Takahiro Mori) https://bitbucket.org/takahiro_mori_win/

## Demo video
[<img width="300" alt="youtube" src="https://user-images.githubusercontent.com/16011609/199163853-a00c3d9b-b4ea-483f-8d22-d1affb59dcd9.png">
](https://www.youtube.com/watch?v=2EkJCJpSpS4)

## æ¦‚è¦
ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã‚’ROS2å¯¾å¿œã«ã•ã›ãŸã‚‚ã®ã§ã™ï¼ã‚·ã‚¹ãƒ†ãƒ è‡ªä½“ã®æ§‹æˆã¯å˜ç´”ã§ï¼Œä¸­èº«ã‚‚å˜ç´”ã§ã™ãŒï¼Œãã®åˆ†ï¼ŒéŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã®ROSå¯¾å¿œã®æ–¹æ³•ãŒç†è§£ã§ãã‚‹ã¨æ€ã„ã¾ã™ï¼åŸºæœ¬çš„ã«ã¯ï¼Œpythonå®Ÿè£…ã•ã‚ŒãŸéŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã®å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“ã®é€šä¿¡ã‚’ROSã§ãƒ©ãƒƒãƒ—ã—ãŸæ§‹æˆã«ãªã£ã¦ã„ã¾ã™ï¼ã“ã®æ§‹æˆã«ã™ã‚‹ã“ã¨ã§ï¼Œé€šä¿¡å†…å®¹ã‚’ROSã§ç›£è¦–ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šï¼Œé€šä¿¡å†…å®¹ã®ç¢ºèªï¼Œè¨˜éŒ²ï¼Œå†ç”ŸãŒå¯èƒ½ã¨ãªã‚‹ãŸã‚ï¼Œã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚°ã®åŠ¹ç‡ãŒæ ¼æ®µã«ä¸ŠãŒã‚Šã¾ã™ï¼

## æ³¨æ„äº‹é …
- ã¾ã ãƒã‚°ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼ãƒã‚°å–ã‚Šæ®µéšã§ã™ï¼

## ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´
ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ã¯ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ™ãƒ¼ã‚¹ã®éŸ³å£°èªè­˜ã¨è‡ªç„¶è¨€èªç”ŸæˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š
- Hugging Face Transformersã‚’ä½¿ç”¨ã—ãŸé«˜ç²¾åº¦ãƒ­ãƒ¼ã‚«ãƒ«éŸ³å£°èªè­˜
- æ—¥æœ¬èªGPT-2ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ãŸãƒ­ãƒ¼ã‚«ãƒ«è¨€èªç”Ÿæˆ
- VOICEVOXã«ã‚ˆã‚‹è‡ªç„¶ãªéŸ³å£°åˆæˆ
- æœ€é©ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚GPUæ¨å¥¨ï¼ˆCPUå‹•ä½œã‚‚å¯èƒ½ï¼‰
- å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ - APIã‚­ãƒ¼ä¸è¦


# ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•
ä»¥ä¸‹ã«ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•ã‚’è¨˜è¼‰ã—ã¾ã™ï¼

## 0. ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶
- OS: Ubuntu 22.04 LTS / macOS 12+ (Montereyä»¥é™)
- Python: 3.10.xï¼ˆUbuntu 22.04ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- ROS2: Humble Hawksbill
- GPU: 
  - Linux: NVIDIA GPUï¼ˆCUDAå¯¾å¿œï¼‰æ¨å¥¨
  - macOS: Apple Siliconï¼ˆM1/M2/M3ï¼‰ã®Metal Performance Shaderså¯¾å¿œ


## 1. ROS2 Humble ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹
https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html

### 1.1 åŸºæœ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# ãƒ­ã‚±ãƒ¼ãƒ«è¨­å®š
sudo locale-gen en_US en_US.UTF-8
sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8
export LANG=en_US.UTF-8

# ROS2ãƒªãƒã‚¸ãƒˆãƒªã®è¿½åŠ 
sudo apt update && sudo apt install curl -y
sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key -o /usr/share/keyrings/ros-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] http://packages.ros.org/ros2/ubuntu $(. /etc/os-release && echo $UBUNTU_CODENAME) main" | sudo tee /etc/apt/sources.list.d/ros2.list > /dev/null

# ROS2 Humbleã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt update
sudo apt upgrade -y
sudo apt install ros-humble-desktop -y
sudo apt install ros-dev-tools -y

# ç’°å¢ƒè¨­å®šã‚’.bashrcã«è¿½åŠ 
echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc
source ~/.bashrc
```

### 1.2ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰Turtlesim ã§ã®ãƒ†ã‚¹ãƒˆ
```bash
# åˆ¥ã€…ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å®Ÿè¡Œ
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1:
ros2 run turtlesim turtlesim_node

# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2:
ros2 run turtlesim turtle_teleop_key
```


## 2. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 2.1 ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
```bash
# é–‹ç™ºãƒ„ãƒ¼ãƒ«
sudo apt update
sudo apt install -y git gcc g++ make cmake build-essential

# Pythoné–¢é€£
sudo apt install -y python3-pip python3-dev python3-venv
sudo apt install -y python-is-python3

# ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªé–¢é€£
sudo apt install -y portaudio19-dev libportaudio2
sudo apt install -y libsndfile1-dev

# ãã®ä»–ã®ä¾å­˜é–¢ä¿‚
sudo apt install -y libcairo2-dev libgirepository1.0-dev
sudo apt install -y libxt-dev libssl-dev libffi-dev
sudo apt install -y zlib1g-dev libbz2-dev libreadline-dev libsqlite3-dev
sudo apt install -y python3-tk tk-dev
```

### 2.2 Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆï¼ˆæ¨å¥¨ï¼‰
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
python3 -m venv venv
source venv/bin/activate

# pipã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
pip install --upgrade pip setuptools wheel
```


## 3. éŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### 3.1 ç’°å¢ƒè¨­å®š
`~/.bashrc` ã«ROS2ç’°å¢ƒã‚’è¿½åŠ :
```bash
# ROS2ç’°å¢ƒ
source /opt/ros/humble/setup.bash
```

### 3.2 Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«éŸ³å£°èªè­˜ãƒ»è¨€èªç”Ÿæˆç”¨ï¼‰
pip install torch transformers

# éŸ³å£°å‡¦ç†é–¢é€£
pip install numpy scipy matplotlib
pip install pyaudio sounddevice
pip install aubio  # ã¾ãŸã¯: pip install git+https://github.com/aubio/aubio/

# éŸ³å£°åˆæˆé–¢é€£
pip install gtts playsound pydub

# ãã®ä»–ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
pip install requests pyworld

# ROS2é–¢é€£ï¼ˆGUIç”¨ï¼‰
pip install PyQt5==5.15.* PySide2 pydot

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼šGoogle Cloud Speech APIï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹èªè­˜ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
# pip install google-cloud-speech
```

### 3.3 VOICEVOXï¼ˆæ—¥æœ¬èªéŸ³å£°åˆæˆï¼‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

VOICEVOXã¯é«˜å“è³ªãªæ—¥æœ¬èªéŸ³å£°åˆæˆã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ï¼

1. VOICEVOXã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
```bash
# æœ€æ–°ç‰ˆã‚’ç¢ºèª: https://github.com/VOICEVOX/voicevox_engine/releases
wget https://github.com/VOICEVOX/voicevox_engine/releases/download/0.14.1/voicevox_engine-linux-cpu-0.14.1.7z
7z x voicevox_engine-linux-cpu-0.14.1.7z
```

2. VOICEVOXã®èµ·å‹•
```bash
cd voicevox_engine-linux-cpu-0.14.1
./run
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§http://localhost:50021ã§èµ·å‹•
```

3. Pythonç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
pip install voicevox-client
```

### 3.4 éŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
`DiaROS/DiaROS_py`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ:

```bash
cd ~/DiaROS/DiaROS_py
pip install -e .
```

### 3.5 ROSãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰

```bash
# colconã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install python3-colcon-common-extensions

# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«ç§»å‹•
cd ~/DiaROS/DiaROS_ros

# ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹ï¼‰ã®ãƒ“ãƒ«ãƒ‰
colcon build --cmake-args -DCMAKE_C_FLAGS=-fPIC --packages-select interfaces
source ./install/local_setup.bash

# DiaROSãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
colcon build --packages-select diaros_package
source ./install/local_setup.bash
```


## 4. å®Ÿè¡Œæ‰‹é †

### 4.1 éŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•
```bash
# æ–°ã—ã„ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§
cd ~/DiaROS/DiaROS_ros
source /opt/ros/humble/setup.bash
source ./install/local_setup.bash

# VOICEVOXã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯äº‹å‰ã«èµ·å‹•ã—ã¦ãŠã
# ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ ./voicevox_engine/run ã‚’å®Ÿè¡Œï¼‰

# ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ã®è¨­å®šã¨ãƒ†ã‚¹ãƒˆ
cd ~/DiaROS
python3 scripts/set_default_mic.py
# ã¾ãŸã¯ç°¡æ˜“éŸ³å£°ãƒ†ã‚¹ãƒˆ
python3 scripts/test_audio_simple.py

# éŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè¡Œ
ros2 launch diaros_package sdsmod.launch.py
# ã¾ãŸã¯è¨­å®šæ¸ˆã¿ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ï¼ˆãƒ‡ãƒã‚¤ã‚¹ã‚’è¨­å®šã—ãŸå ´åˆï¼‰
/path/to/config/launch_diaros_with_mic.sh
```

### 4.2 ã‚·ã‚¹ãƒ†ãƒ ã®åœæ­¢
`Ctrl+C` ã§çµ‚äº†ã—ã¾ã™ï¼


## 5. ROS2ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ„ãƒ¼ãƒ«ã®æ´»ç”¨

### 5.1 rqt_graph - ãƒãƒ¼ãƒ‰ã¨ãƒˆãƒ”ãƒƒã‚¯ã®å¯è¦–åŒ–
```bash
# ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®é€šä¿¡æ§‹é€ ã‚’è¦–è¦šçš„ã«ç¢ºèª
ros2 run rqt_graph rqt_graph
```

### 5.2 ros2 topic - ãƒˆãƒ”ãƒƒã‚¯ã®ç›£è¦–
```bash
# åˆ©ç”¨å¯èƒ½ãªãƒˆãƒ”ãƒƒã‚¯ä¸€è¦§
ros2 topic list

# ç‰¹å®šãƒˆãƒ”ãƒƒã‚¯ã®å†…å®¹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
ros2 topic echo /speech_recognition
ros2 topic echo /dialogue_response
ros2 topic echo /speech_synthesis

# ãƒˆãƒ”ãƒƒã‚¯ã®å‘¨æ³¢æ•°ç¢ºèª
ros2 topic hz /audio_input
```

### 5.3 ros2 bag - ãƒ‡ãƒ¼ã‚¿ã®è¨˜éŒ²ã¨å†ç”Ÿ
```bash
# ã™ã¹ã¦ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’è¨˜éŒ²
ros2 bag record -a

# ç‰¹å®šã®ãƒˆãƒ”ãƒƒã‚¯ã®ã¿è¨˜éŒ²
ros2 bag record /speech_recognition /dialogue_response

# è¨˜éŒ²ã—ãŸãƒ‡ãƒ¼ã‚¿ã®æƒ…å ±ç¢ºèª
ros2 bag info <bag_file>

# è¨˜éŒ²ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å†ç”Ÿ
ros2 bag play <bag_file>
```

### 5.4 rqt_plot - ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–
```bash
# éŸ³å£°ãƒ¬ãƒ™ãƒ«ãªã©ã®æ•°å€¤ãƒ‡ãƒ¼ã‚¿ã‚’ã‚°ãƒ©ãƒ•è¡¨ç¤º
ros2 run rqt_plot rqt_plot
```

### 5.5 ãã®ä»–ã®ä¾¿åˆ©ãªã‚³ãƒãƒ³ãƒ‰
```bash
# ãƒãƒ¼ãƒ‰ä¸€è¦§
ros2 node list

# ãƒãƒ¼ãƒ‰æƒ…å ±
ros2 node info /speech_recognition_node

# ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§
ros2 service list

# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸€è¦§
ros2 param list
```


## 6. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 6.1 ã‚µã‚¦ãƒ³ãƒ‰ãƒ‡ãƒã‚¤ã‚¹ï¼ˆUSBãƒ˜ãƒƒãƒ‰ã‚»ãƒƒãƒˆï¼‰ãŒèªè­˜ã•ã‚Œãªã„å ´åˆ
```bash
# ã‚«ãƒ¼ãƒãƒ«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®æ›´æ–°
sudo apt update
sudo apt upgrade linux-generic

# å†èµ·å‹•å¾Œã€ãƒ‡ãƒã‚¤ã‚¹ã‚’ç¢ºèª
pactl list short sources
pactl list short sinks
```

### 6.2 ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚µã‚¦ãƒ³ãƒ‰ãƒ‡ãƒã‚¤ã‚¹ã®å›ºå®š

#### è‡ªå‹•è¨­å®šï¼ˆæ¨å¥¨ï¼‰
```bash
# éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹è¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨
cd ~/DiaROS
python3 scripts/set_default_mic.py
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š
- åˆ©ç”¨å¯èƒ½ãªéŸ³å£°å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ã‚’ä¸€è¦§è¡¨ç¤º
- ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸æŠã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
- DiaROSç”¨ã®è¨­å®šã‚’ä¿å­˜
- è¨­å®šæ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹ã§èµ·å‹•ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ

#### æ‰‹å‹•è¨­å®š
```bash
# å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§ç¢ºèª
pactl list short sources

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‡ãƒã‚¤ã‚¹ã®è¨­å®š
pactl set-default-source <device_name>

# ~/.bashrcã«è¿½åŠ ã—ã¦æ°¸ç¶šåŒ–
echo "pactl set-default-source <device_name>" >> ~/.bashrc

# ã¾ãŸã¯DiaROSç”¨ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
export AUDIO_DEVICE_INDEX=<device_number>
```

### 6.3 ALSAé–¢é€£ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æŠ‘åˆ¶
Unknown PCM cardsãªã©ã®ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹å ´åˆï¼š
```bash
# /usr/share/alsa/alsa.conf ã®ä¸è¦ãªè¨­å®šã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
sudo nano /usr/share/alsa/alsa.conf
# cards.pcm.rear, cards.pcm.center_lfe ãªã©ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
```

### 6.4 Python GTTSã§ã®ã‚¨ãƒ©ãƒ¼å¯¾å‡¦
```bash
# No module named 'gi' ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
sudo apt install libcairo2-dev libgirepository1.0-dev
pip install pycairo PyGObject
```

### 6.5 ROS2é–¢é€£ã®ãƒˆãƒ©ãƒ–ãƒ«
```bash
# ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
printenv | grep ROS

# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®ã‚¯ãƒªãƒ¼ãƒ³ãƒ“ãƒ«ãƒ‰
cd ~/DiaROS/DiaROS_ros
rm -rf build/ install/ log/
colcon build
```


## 7. é–‹ç™ºè€…å‘ã‘æƒ…å ±

### 7.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
```
DiaROS/
â”œâ”€â”€ DiaROS_py/          # PythonéŸ³å£°å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ DiaROS_ros/         # ROS2ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ interfaces/     # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹å®šç¾©
â”‚   â””â”€â”€ diaros_package/ # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â””â”€â”€ docs/               # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

### 7.2 ä¸»è¦ãªROSãƒˆãƒ”ãƒƒã‚¯
- `/audio_input`: ãƒã‚¤ã‚¯ã‹ã‚‰ã®éŸ³å£°å…¥åŠ›
- `/speech_recognition`: éŸ³å£°èªè­˜çµæœ
- `/dialogue_response`: å¯¾è©±ã‚·ã‚¹ãƒ†ãƒ ã®å¿œç­”
- `/speech_synthesis`: éŸ³å£°åˆæˆçµæœ
- `/audio_output`: ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã¸ã®éŸ³å£°å‡ºåŠ›

### 7.3 ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«
ã‚·ã‚¹ãƒ†ãƒ ã¯é«˜åº¦ãªéŸ³å£°å‡¦ç†ã®ãŸã‚ã«ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ï¼š
- **éŸ³å£°èªè­˜**: Hugging Face japanese-HuBERT-base-VADLess-ASRãƒ¢ãƒ‡ãƒ«
- **è¨€èªç”Ÿæˆ**: rinna/japanese-gpt2-smallã«ã‚ˆã‚‹è‡ªç„¶ãªå¿œç­”ç”Ÿæˆ
- **éŸ³å£°åˆæˆ**: VOICEVOXã«ã‚ˆã‚‹é«˜å“è³ªãªæ—¥æœ¬èªéŸ³å£°
- æœ€é©ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãŸã‚GPUæ¨å¥¨ï¼ˆCUDAå¯¾å¿œï¼‰

### 7.4 éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†
DiaROSã«ã¯éŸ³å£°ãƒ‡ãƒã‚¤ã‚¹ã‚’ç®¡ç†ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š
- **scripts/set_default_mic.py**: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒã‚¤ã‚¹è¨­å®šãƒ„ãƒ¼ãƒ«
  - åˆ©ç”¨å¯èƒ½ãªéŸ³å£°å…¥åŠ›ãƒ‡ãƒã‚¤ã‚¹ã‚’ä¸€è¦§è¡¨ç¤º
  - ãƒ‡ãƒã‚¤ã‚¹ã®æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
  - ãƒ‡ãƒã‚¤ã‚¹è¨­å®šã‚’ä¿å­˜
  - äº‹å‰è¨­å®šæ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹ã§èµ·å‹•ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
- **scripts/test_audio_simple.py**: ç°¡æ˜“éŸ³å£°ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  - PyAudioã®ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºã‚’ç¢ºèª
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§éŸ³å£°ãƒ¬ãƒ™ãƒ«ã‚’è¡¨ç¤º
- **è‡ªå‹•ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º**: Dockerç’°å¢ƒã§ã¯PulseAudioãƒ‡ãƒã‚¤ã‚¹ã‚’å„ªå…ˆ
- **ç’°å¢ƒå¤‰æ•°**: `AUDIO_DEVICE_INDEX`ã§ãƒ‡ãƒã‚¤ã‚¹ã‚’æŒ‡å®šå¯èƒ½


## 8. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨è¬è¾
æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ç ”ç©¶ç›®çš„ã§é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ï¼
å„ç¨®APIã®åˆ©ç”¨è¦ç´„ã«å¾“ã£ã¦ã”ä½¿ç”¨ãã ã•ã„ï¼

### ä½¿ç”¨ã—ã¦ã„ã‚‹ä¸»è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ»API
- ROS2 Humble
- Hugging Face Transformersï¼ˆãƒ­ãƒ¼ã‚«ãƒ«éŸ³å£°èªè­˜ãƒ»è¨€èªç”Ÿæˆï¼‰
- VOICEVOXï¼ˆæ—¥æœ¬èªéŸ³å£°åˆæˆï¼‰
- PyAudio
- ãã®ä»–å¤šæ•°ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª


## 9. macOSãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè¡Œï¼ˆApple Silicon GPUæ´»ç”¨ï¼‰

### 9.1 æ¦‚è¦
Apple Silicon Macï¼ˆM1/M2/M3ï¼‰ã§ã¯ã€Metal Performance Shadersï¼ˆMPSï¼‰ã‚’ä½¿ç”¨ã—ã¦GPUã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½ã§ã™ã€‚Dockerç’°å¢ƒã§ã¯MPSãŒä½¿ç”¨ã§ããªã„ãŸã‚ã€æœ€é«˜ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å¾—ã‚‹ã«ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè¡Œã‚’æ¨å¥¨ã—ã¾ã™ã€‚

**è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰**: ğŸ“– [docs/macos_native_setup.md](docs/macos_native_setup.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### 9.2 ã‚¯ã‚¤ãƒƒã‚¯ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆPixiã‚’ä½¿ç”¨ï¼‰

#### å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# Xcodeã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«
xcode-select --install

# Homebrewï¼ˆã¾ã ã®å ´åˆï¼‰
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zshrc
source ~/.zshrc
```

#### Pixiã‚’ä½¿ã£ãŸROS2ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰

##### 1. Pixiã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
```bash
# Pixiã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -fsSL https://pixi.sh/install.sh | bash
source ~/.zshrc  # ã¾ãŸã¯ ~/.bashrc

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
mkdir -p ~/DiaROS_pixi && cd ~/DiaROS_pixi

# Pixiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸåŒ–ï¼ˆPython 3.9ã‚’ä½¿ç”¨ï¼‰
pixi init diaros_workspace -c robostack-humble -c conda-forge
cd diaros_workspace
```

##### 2. ROS2 Humbleã¨ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# Python 3.9ã‚’æœ€åˆã«è¿½åŠ ï¼ˆé‡è¦ï¼‰
pixi add python=3.9

# ROS2 Humbleã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pixi add ros-humble-desktop colcon-common-extensions pip

# ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«ã®è¿½åŠ 
pixi add cython setuptools-scm
```

##### 3. DiaROSã®ã‚¯ãƒ­ãƒ¼ãƒ³
```bash
cd ~/DiaROS_pixi
git clone https://github.com/sayonari/DiaROS_imamoto.git
```

##### 4. Pixiç’°å¢ƒã§ã®Pythonãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# Pixiç’°å¢ƒã«å…¥ã‚‹
cd ~/DiaROS_pixi/diaros_workspace
pixi shell

# åŸºæœ¬ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install numpy==1.24.3  # NumPy 1.xã«å›ºå®šï¼ˆé‡è¦ï¼‰
pip install torch torchvision torchaudio
pip install transformers huggingface-hub
pip install pyaudio sounddevice librosa scipy
pip install matplotlib requests pyyaml webrtcvad pyworld soundfile

# aubioã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆmacOSã§ã®ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼å¯¾ç­–ï¼‰
brew install aubio  # Homebrewã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
export PKG_CONFIG_PATH="/opt/homebrew/lib/pkgconfig:$PKG_CONFIG_PATH"
export CFLAGS="-Wno-error=incompatible-function-pointer-types"
export LDFLAGS="-L/opt/homebrew/lib"  
export CPPFLAGS="-I/opt/homebrew/include"
pip install aubio --no-cache-dir

# è¿½åŠ ã®å¿…é ˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
pip install playsound pydub PyObjC

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
python -c "import torch; print(f'MPS available: {torch.backends.mps.is_available()}')"
pip list | grep -E "aubio|pyaudio|torch|transformers|playsound|pydub"
```

**è©³ç´°**: ğŸ“– [docs/macos_pixi_ros2_setup.md](docs/macos_pixi_ros2_setup.md)

#### ä»£æ›¿æ–¹æ³•ï¼šROS2ãªã—ã§ã®å®Ÿè¡Œ
ROS2ãªã—ã§ã‚‚åŸºæœ¬æ©Ÿèƒ½ã¯å‹•ä½œã—ã¾ã™ã€‚è©³ç´°ã¯ [docs/macos_quick_start.md](docs/macos_quick_start.md) ã‚’å‚ç…§ã€‚

#### DiaROSã®ãƒ“ãƒ«ãƒ‰ã¨èµ·å‹•ï¼ˆPixiç’°å¢ƒï¼‰

##### 5. ROS2ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
```bash
# Pixiç’°å¢ƒã§DiaROSãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/DiaROS_pixi/DiaROS_imamoto/DiaROS_ros

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆé‡è¦ï¼‰
export Python3_ROOT_DIR=$CONDA_PREFIX
export Python3_EXECUTABLE=$CONDA_PREFIX/bin/python
export Python3_INCLUDE_DIR=$CONDA_PREFIX/include/python3.9
export Python3_LIBRARY=$CONDA_PREFIX/lib/libpython3.9.dylib
export Python3_NumPy_INCLUDE_DIR=$(python -c "import numpy; print(numpy.get_include())")

# interfacesãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
colcon build \
  --cmake-args \
  -DCMAKE_C_FLAGS=-fPIC \
  -DPython3_FIND_STRATEGY=LOCATION \
  -DPython3_ROOT_DIR=$CONDA_PREFIX \
  --packages-select interfaces

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®šï¼ˆDiaROSãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç”¨ï¼‰
export ROS_DISTRO=humble
export ROS_VERSION=2
export ROS_PYTHON_VERSION=3
export AMENT_PREFIX_PATH=$PWD/install/interfaces:$CONDA_PREFIX
export CMAKE_PREFIX_PATH=$PWD/install/interfaces:$CONDA_PREFIX
export PYTHONPATH=$PWD/install/interfaces/lib/python3.9/site-packages:$PYTHONPATH

# DiaROSãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
colcon build --packages-select diaros_package
```

##### 6. DiaROS Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
# DiaROS_pyãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ../DiaROS_py

# pyproject.tomlã®Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³è¦ä»¶ã‚’ç¢ºèªï¼ˆ3.9ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ï¼‰
# å¿…è¦ã«å¿œã˜ã¦ç·¨é›†: requires-python = ">=3.9"

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -e .

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
python -c "import diaros; print('DiaROS module imported successfully')"
```

##### 7. VOICEVOXã®èµ·å‹•ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰
```bash
# VOICEVOXã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
cd ~/Downloads
curl -L https://github.com/VOICEVOX/voicevox_engine/releases/download/0.14.0/macos-x64.zip -o voicevox.zip
unzip voicevox.zip
cd macos-x64
./run
```

##### 7.5. HuggingFaceãƒˆãƒ¼ã‚¯ãƒ³ã®è¨­å®šï¼ˆå¿…è¦ãªå ´åˆï¼‰
ä¸€éƒ¨ã®ãƒ¢ãƒ‡ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«ã¯ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™ï¼š
```bash
# HuggingFace CLIã§ãƒ­ã‚°ã‚¤ãƒ³
pip install huggingface-cli
huggingface-cli login

# ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã§è¨­å®š
export HF_TOKEN=your_token_here
```

##### 8. DiaROSã®èµ·å‹•
```bash
# DiaROSãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/DiaROS_pixi/DiaROS_imamoto/DiaROS_ros

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
export DIAROS_DEVICE=mps  # Apple Silicon GPUã‚’ä½¿ç”¨
export AMENT_PREFIX_PATH=$PWD/install/diaros_package:$PWD/install/interfaces:$AMENT_PREFIX_PATH
export PYTHONPATH=$PWD/install/diaros_package/lib/python3.9/site-packages:$PWD/install/interfaces/lib/python3.9/site-packages:$PYTHONPATH

# å‹•çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‘ã‚¹ã®è¨­å®šï¼ˆå¿…è¦ãªå ´åˆï¼‰
export DYLD_LIBRARY_PATH=$PWD/install/interfaces/lib:$DYLD_LIBRARY_PATH

# power_calibration.wavãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ”ãƒ¼ï¼ˆåˆå›ã®ã¿ï¼‰
cp ../DiaROS_py/diaros/power_calibration.wav .

# DiaROSã®èµ·å‹•
ros2 launch diaros_package sdsmod.launch.py
```

### 9.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¯”è¼ƒ

| ç’°å¢ƒ | ãƒ‡ãƒã‚¤ã‚¹ | éŸ³å£°èªè­˜ | è¨€èªç”Ÿæˆ | ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¤ã‚­ãƒ³ã‚° |
|------|----------|---------|---------|---------------|
| Docker | CPU (8ã‚³ã‚¢) | ~500ms | ~1000ms | ~200ms |
| Native | MPS (GPU) | ~50ms | ~100ms | ~20ms |
| Native | CPU | ~300ms | ~800ms | ~150ms |

**çµæœ**: MPSã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€**æœ€å¤§10å€ã®é«˜é€ŸåŒ–**ã‚’å®Ÿç¾ï¼

### 9.4 ç’°å¢ƒå¤‰æ•°ã¨ãƒ‡ãƒã‚¤ã‚¹é¸æŠ

```bash
# MPSã‚’å„ªå…ˆçš„ã«ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
export DIAROS_DEVICE=mps

# CPUã«å›ºå®šã™ã‚‹å ´åˆ
export DIAROS_DEVICE=cpu

# è‡ªå‹•é¸æŠï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
unset DIAROS_DEVICE
```

ãƒ‡ãƒã‚¤ã‚¹ã®å„ªå…ˆé †ä½ï¼š
1. ç’°å¢ƒå¤‰æ•°`DIAROS_DEVICE`ã®æŒ‡å®š
2. MPSï¼ˆApple Silicon GPUï¼‰
3. CUDAï¼ˆNVIDIA GPUï¼‰
4. CPU

### 9.5 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### PyAudioã‚¨ãƒ©ãƒ¼
```bash
brew reinstall portaudio
pip uninstall pyaudio && pip install pyaudio
```

#### aubioãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼
ã€Œincompatible function pointer typesã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆï¼š
```bash
# Homebrewã§aubioãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
brew install aubio

# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
export PKG_CONFIG_PATH="/opt/homebrew/lib/pkgconfig:$PKG_CONFIG_PATH"
export CFLAGS="-Wno-error=incompatible-function-pointer-types"
export LDFLAGS="-L/opt/homebrew/lib"
export CPPFLAGS="-I/opt/homebrew/include"

# aubioã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install aubio --no-cache-dir
```

è©³ç´°: [docs/macos_aubio_build_fix.md](docs/macos_aubio_build_fix.md)

#### ROS2ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚‰ãªã„
ã€ŒPackage 'diaros_package' not foundã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆï¼š
```bash
# ç’°å¢ƒå¤‰æ•°ã‚’æ­£ã—ãè¨­å®š
export AMENT_PREFIX_PATH=$PWD/install/diaros_package:$PWD/install/interfaces:$AMENT_PREFIX_PATH
export ROS_DISTRO=humble
export ROS_VERSION=2

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¢ºèª
ros2 pkg list | grep diaros
```

#### Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä¸ä¸€è‡´
CMakeãŒPython 3.12ã‚’è¦‹ã¤ã‘ã‚‹å ´åˆï¼š
```bash
# Pixiç’°å¢ƒã®Python 3.9ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
export Python3_EXECUTABLE=$CONDA_PREFIX/bin/python
export Python3_ROOT_DIR=$CONDA_PREFIX
```

#### MPSã‚¨ãƒ©ãƒ¼
```bash
# ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æœ‰åŠ¹åŒ–
export PYTORCH_ENABLE_MPS_FALLBACK=1
```

#### å‹•çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼
ã€ŒLibrary not loaded: @rpath/libinterfaces__rosidl_generator_py.dylibã€ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆï¼š
```bash
# å‹•çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ‘ã‚¹ã‚’è¨­å®š
export DYLD_LIBRARY_PATH=$PWD/install/interfaces/lib:$DYLD_LIBRARY_PATH
```

#### ãƒã‚¤ã‚¯æ¨©é™
ã‚·ã‚¹ãƒ†ãƒ è¨­å®š â†’ ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ â†’ ãƒã‚¤ã‚¯ â†’ ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’è¨±å¯

### 9.6 å¿…è¦ãªãƒ¢ãƒ‡ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

HuggingFaceã®åˆ¶é™ä»˜ããƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼š
1. https://huggingface.co/ ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. ä»¥ä¸‹ã®ãƒ¢ãƒ‡ãƒ«ãƒšãƒ¼ã‚¸ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã«åŒæ„ï¼š
   - [japanese-HuBERT-base-VADLess-ASR-RSm](https://huggingface.co/SiRoZaRuPa/japanese-HuBERT-base-VADLess-ASR-RSm)
3. ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šï¼š
   ```bash
   huggingface-cli login
   # ã¾ãŸã¯
   export HF_TOKEN=your_token_here
   ```

## 10. ä»˜éŒ²ï¼šå¤–éƒ¨APIã®ä½¿ç”¨ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

DiaROSã¯ç¾åœ¨ã€å¤–éƒ¨APIãªã—ã§å®Œå…¨ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã—ã¾ã™ãŒã€ã‚ˆã‚Šé«˜ã„ç²¾åº¦ã‚’æ±‚ã‚ã‚‹å ´åˆã¯ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š

### 10.1 Google Speech-to-Text APIï¼ˆéŸ³å£°èªè­˜ï¼‰
1. Google Cloud Consoleã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
2. Speech-to-Text APIã‚’æœ‰åŠ¹åŒ–
3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ä½œæˆï¼ˆJSONå½¢å¼ï¼‰
4. è©³ç´°æ‰‹é †: https://cloud.google.com/speech-to-text/docs/before-you-begin?hl=ja
5. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:
   ```bash
   export GOOGLE_APPLICATION_CREDENTIALS="$HOME/secret/google_stt_key.json"
   ```

### 10.2 OpenAI APIï¼ˆå¿œç­”ç”Ÿæˆï¼‰
1. https://platform.openai.com/ ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. APIã‚­ãƒ¼ã‚’ä½œæˆ
3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:
   ```bash
   export OPENAI_API_KEY="your-api-key-here"
   ```
4. `naturalLanguageGeneration.py`ã§`self.use_local_model = False`ã«å¤‰æ›´

### 10.3 A3RT Talk APIï¼ˆä»£æ›¿å¿œç­”ç”Ÿæˆï¼‰
1. APIã‚­ãƒ¼ã‚’å–å¾—: https://a3rt.recruit.co.jp/product/talkAPI/
2. APIã‚­ãƒ¼ã‚’ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
3. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:
   ```bash
   export A3RT_APIKEY="$HOME/secret/a3rt_api_key.txt"
   ```
   æ³¨ï¼šç¾åœ¨ã®å®Ÿè£…ã§ã¯OpenAI APIã¾ãŸã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™